/**
 * Created by Administrator on 2016/1/19 0019.
 */
//文件要实现动态加载和延迟加载
var data1={
    "recommend": {
        "recommendList": [
            {
                "type": "ware",
                "wareId": "847460",
                "wname": "台湾蜜兰诺松塔128g（8包装）",
                "jdPrice": "16.90",
                "imageurl": "sucai/c1.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_0_847460_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "617825",
                "wname": "康夫（Kangfu）KF8905美发套装电吹风2300W大功率吹风筒（含直发器和造型风罩）",
                "jdPrice": "99.00",
                "imageurl": "sucai/c2.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_1_617825_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1278560",
                "wname": "半球（Peskoe）WDF-1.8A不锈钢电水壶1.8L全钢盖干烧断电保护",
                "jdPrice": "29.90",
                "imageurl": "sucai/c3.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_2_1278560_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1436023739",
                "wname": "轩之梦汽车掸子除尘掸子洗车拖把蜡拖洗车刷汽车用品洗车配件车掸子升级套餐",
                "jdPrice": "39.90",
                "imageurl": "sucai/c4.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_3_1436023739_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1426784",
                "wname": "羽博20000毫安S9双USB输出移动电源/充电宝白色通用手机平板",
                "jdPrice": "69.00",
                "imageurl": "sucai/c5.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_4_1426784_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1669100549",
                "wname": "MILK&LOVE首饰天然玛瑙手链红玛瑙手串饰品男女通用款8MM红玛瑙手链",
                "jdPrice": "168.00",
                "imageurl": "sucai/c6.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_5_1669100549_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "680533",
                "wname": "德国进口RitterSport瑞特斯波德迷你七彩什锦巧克力150g",
                "jdPrice": "45.00",
                "imageurl": "sucai/c7.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_6_680533_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1165762",
                "wname": "蓝月亮手洗专用洗衣液翻盖（风清白兰）500g/瓶",
                "jdPrice": "12.80",
                "imageurl": "sucai/c8.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_7_1165762_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "906180",
                "wname": "蜂花柔顺营养护发素1L",
                "jdPrice": "18.20",
                "imageurl": "sucai/c9.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_8_906180_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1506246975",
                "wname": "帅康（Sacon）TE6726+35B欧式油烟机燃气灶具套装全不锈钢防碰头系列",
                "jdPrice": "2799.00",
                "imageurl": "sucai/c10.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_9_1506246975_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1053352375",
                "wname": "德力西LED灯带高压暗槽灯条吊顶软灯带3528贴片高亮防水60灯珠/米暖白",
                "jdPrice": "12.50",
                "imageurl": "sucai/c11.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_10_1053352375_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "908037",
                "wname": "韩国所望SOMANG牛奶身体乳500ml",
                "jdPrice": "69.00",
                "imageurl": "sucai/c12.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_11_908037_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1612839",
                "wname": "法国利奥雷诺（LTWFRANE）卡包男士钱包头层牛皮长款钱夹商务休闲多卡位卡包K30101黑色",
                "jdPrice": "99.00",
                "imageurl": "sucai/c13.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_12_1612839_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1647579738",
                "wname": "如昊LED光控感应小夜灯可爱天使喂奶氛围灯卧室书房楼梯过道壁灯节日温馨灯饰黄光",
                "jdPrice": "19.80",
                "imageurl": "sucai/c14.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_13_1647579738_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1732816621",
                "wname": "【货到付款】小黄人小学生书包男女生双肩儿童书包红色儿童书包",
                "jdPrice": "99.00",
                "imageurl": "sucai/c15.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_14_1732816621_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "246511",
                "wname": "佳洁士(Crest)全优7效牙刷(专利斜向交叉刷毛清洁更彻底舌苔清洁美国进口)",
                "jdPrice": "14.90",
                "imageurl": "sucai/c16.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_15_246511_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1185780041",
                "wname": "大希地澳洲进口牛排套餐10片【+1元购进口意面！买2份送鳕鱼柳！】赠刀叉黄油酱包",
                "jdPrice": "168.00",
                "imageurl": "sucai/c17.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_16_1185780041_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1731395988",
                "wname": "魔力擦洗碗海绵百洁布9个装拍2笔送百洁布",
                "jdPrice": "9.90",
                "imageurl": "sucai/c18.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_17_1731395988_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1679254162",
                "wname": "仿真花藤条假花绢花玫瑰花藤空调管道水管客厅装饰花藤藤蔓香槟色",
                "jdPrice": "14.60",
                "imageurl": "sucai/c19.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_18_1679254162_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1145313",
                "wname": "万和（Vanward）CXW-200-X65HW欧式吸油烟机",
                "jdPrice": "1798.00",
                "imageurl": "sucai/c20.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_19_1145313_5_1_null"
            }
        ],
        "floorIntro": "19: 56为你推荐已更新",
        "p": "620003",
        "code": "0",
        "totalPage": 23,
        "expid": "105"
    }
};


var data={
    "recommend": {
        "recommendList": [
            {
                "type": "ware",
                "wareId": "1027569322",
                "wname": "雅高家用彩色加厚垃圾袋中号随机色发货5卷150只",
                "jdPrice": "13.90",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t2107/63/304108433/320932/2d6479ec/55feb087N3ea5a646.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_0_1027569322_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1372048990",
                "wname": "七匹狼纯棉袜子男士男袜休闲商务袜子6双简约礼盒装",
                "jdPrice": "48.00",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t742/342/1245262321/140080/15e253b8/5523ad20N5c51af76.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_1_1372048990_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1334529",
                "wname": "BIAZELightning/Micro二合一数据线电源线炫彩灯适用苹果iPhone6s/PlusiPadAirProMini三星小米金色",
                "jdPrice": "19.90",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t1174/265/251781351/46686/63d3a610/55190ef9N6095f3ad.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_2_1334529_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1286815",
                "wname": "马连奴奥兰迪（MarinoOrlandi）爱尔蝶印花女士实用手抓包零钱包啡色",
                "jdPrice": "49.00",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t496/363/673571907/191912/c2c17ad7/547d516aN3aa5510c.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_3_1286815_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1748319363",
                "wname": "USCAMEL新款高端望远镜高清高倍微光夜视双筒望远镜黑色UW008F",
                "jdPrice": "198.00",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t2560/23/237995378/334948/db97bce4/563dc0a5Nd7cbfa08.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_4_1748319363_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "850164",
                "wname": "Nestle雀巢中老年营养奶粉400g袋装",
                "jdPrice": "39.90",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t1012/317/1276928417/132318/ca80f7c3/558a7174N6c0fc5e0.jpg",
                "lookSimilar": "0",
                "sourceValue": "0_68_5_850164_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "209951",
                "wname": "维达卫生纸蓝色经典140g卷纸*10卷",
                "jdPrice": "18.90",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t1342/354/428785858/111352/ce701549/55769c04Nbd1ad1d0.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_6_209951_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1341325",
                "wname": "绿之源空气甲醛自测盒（精准装）",
                "jdPrice": "39.00",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t1879/118/396743841/117403/251ae184/5604b074N634ac653.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_7_1341325_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1192475",
                "wname": "完美芦荟胶40g3支装",
                "jdPrice": "69.00",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t595/197/509204436/102860/1bd3c1b/546e9e81N8f2d62eb.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_8_1192475_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "543107",
                "wname": "美的(Midea)F05-15A(S)（上出水)5升小厨宝（白色+印花）",
                "jdPrice": "399.00",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t658/333/1140835367/67076/a002f396/54b3a993Ndb4e6946.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_9_543107_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1251332",
                "wname": "良品铺子肉干肉脯手撕香辣牛肉干80g",
                "jdPrice": "19.90",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t1612/37/359077648/230473/8767dcb7/5576ca24Ne4790b0a.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_10_1251332_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1160126",
                "wname": "泰国进口小老板烤海苔卷（原味）36g",
                "jdPrice": "23.50",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t1771/315/509193859/168006/27480f2e/55d3fab4Nc53a3bea.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_11_1160126_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "2002459",
                "wname": "多芬(Dove)男士+护理强韧洗发露养根健发50ml(体验装)",
                "jdPrice": "15.00",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t2092/143/576309414/55402/210a0812/5618e447N4b169ec8.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_12_2002459_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1250262",
                "wname": "美赞臣(MeadJohnson)安婴宝A+较大婴儿配方奶粉2段(6-12个月较大婴儿适用)900克(进口奶源)新包装",
                "jdPrice": "220.00",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t2275/46/1371263351/111089/5403fc2f/56581dbeNa26b8a9e.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_13_1250262_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1547652689",
                "wname": "意大利Baillr手包男士真皮男款手拿包长款钱包休闲手抓包闪电纹棕色",
                "jdPrice": "69.00",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t2113/339/1739255285/281841/55ad4174/56725ac6N594de1a5.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_14_1547652689_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1502262878",
                "wname": "亿享宝宝童车三轮儿童滑板车加宽踏板车折叠可升降扭扭车小孩玩具绿色",
                "jdPrice": "78.00",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t1789/334/374325620/113944/6fc04052/55d123f7N8d18f83d.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_15_1502262878_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "334420",
                "wname": "马来西亚进口益昌老街即溶咖啡200g",
                "jdPrice": "19.00",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t1816/178/1403632398/179402/64f3a329/55f00385N903dddfc.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_16_334420_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1800510439",
                "wname": "【2只免邮】南极人家纺秋冬暖和短毛绒夹棉加厚坐垫办公餐桌椅子学生垫子咖色40cm*40cm",
                "jdPrice": "9.90",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t2209/133/665350080/226118/ab112f4b/562112deN3f82fd64.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_17_1800510439_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1754375110",
                "wname": "好福气JM-812全自动足浴盆深桶洗脚盆JM-812自助标准版",
                "jdPrice": "159.00",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_jfs/t2197/134/1115586162/136403/a602f450/5679187eN727f794b.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_18_1754375110_5_1_null"
            },
            {
                "type": "ware",
                "wareId": "1106432",
                "wname": "美的（Midea）F60-15WB5(Y)60升电热水器",
                "jdPrice": "1298.00",
                "imageurl": "http://m.360buyimg.com/mobilecms/s276x276_g15/M00/19/11/rBEhWFNbQ5IIAAAAAACZXDlEBTEAAMcKAIeVNgAAJl0232.jpg",
                "lookSimilar": "1",
                "sourceValue": "0_68_19_1106432_5_1_null"
            }
        ],
        "floorIntro": "09: 31为你推荐已更新",
        "p": "620003",
        "code": "0",
        "totalPage": 23,
        "expid": "105"
    }
};

// $(function(){
//     $.ajax({
//         type:"get",
//         url:"../FirstWeb/YouLikeData1.php",
//         success:function(data){
//             var JsonData=JSON.parse(data);
//             pinterest(JsonData);

//             //Countdown('2016-01-20T15:26:00');//定时格式以2016-01-19T15:26:00为例
//             //如果日期采用连词线（-）格式分隔，且具有前导0，JavaScript会认为这是一个ISO格式的日期字符串，导致返回的时间是以UTC时区计算的。
//         },
//         error:function(){
//             console.log("error");
//         }
//     })
// });

            pinterest(data1);

function pinterest(data){
    var pinterestImgDataIndex=0;

    function createYouLikeCell(data){
        var pinterestImgDataArry=[];
        for(var i=0;i<4;i++){          //ajax获取了20条数据，但这里只取

            if(pinterestImgDataIndex>=19){
                $("#ContinueLoadBox").off("click").on("click",function(){
                //由于on在循环体中被多次绑定，点击后会发生多次执行，遇到这种情况需要在每次绑定事件之前，对该事件解绑，off方法解绑。
                    pinterestImgDataIndex=0;
                    console.log(pinterestImgDataIndex);
                    $.ajax({
                        type:"get",
                        url:"http://192.168.2.108/work25/YouLikeData1.php",
                        success:function(data){
                            var JsonData=JSON.parse(data);
                            createYouLikeCell(JsonData);

                            //Countdown('2016-01-20T15:26:00');//定时格式以2016-01-19T15:26:00为例
                            //如果日期采用连词线（-）格式分隔，且具有前导0，JavaScript会认为这是一个ISO格式的日期字符串，导致返回的时间是以UTC时区计算的。
                        },
                        error:function(){
                            console.log("error");
                        }
                    });
                    //createYouLikeCell(data);
                    //$(window).trigger("scroll");
                });

            }else{
                pinterestImgDataArry[i]=data.recommend.recommendList[pinterestImgDataIndex];
                pinterestImgDataIndex++;
            }
        }
        if(pinterestImgDataIndex<19){
            $.each($(pinterestImgDataArry),function(index,value){
                //var GuessCell=$("<li>").addClass("GuessCell").appendTo("#Guess");
                var GuessCell=$("<li>").addClass("GuessCell").insertBefore("#GuessCellClear");
                var GuessCellA=$("<a>").attr("href","javascript:;").appendTo(GuessCell);
                var imgBox=$("<div>").addClass("imgBox").appendTo(GuessCellA);
                var imgBoxIMG=$("<img>").attr("src",""+$(value).attr("imageurl")).appendTo(imgBox);
                var MiaoShu=$("<div>").addClass("MiaoShu").appendTo(GuessCellA);
                var MiaoShuSpan=$("<span>").text(""+$(value).attr("wname")).appendTo(MiaoShu);
                var jiaQian=$("<div>").addClass("jiaQian").appendTo(GuessCell);
                var jiaQianSpan=$("<span>").html("&yen;"+$(value).attr("jdPrice")).appendTo(jiaQian);
                //此处若为text则显示为“&yen;19。00”，此处若为html则显示为“￥19。00”
                var jiaQianA=$("<a>").attr("href","javascript:;").text("看相似").appendTo(jiaQian);
            });
        }


        //知识点
        //$(selector).each()是用来让DOM循环结构更简单更不易出错。它会迭代jQuery对象中的每一个DOM元素。每次回调函数执行时，会传递当前循环次数作为参数(从0开始计数)。
        // 更重要的是，回调函数是在当前DOM元素为上下文的语境中触发的。因此关键字 this 总是指向这个元素。
        //$.each()函数和 $(selector).each()是不一样的，那个是专门用来遍历一个jQuery对象。
        // $.each()函数可用于迭代任何集合，无论是“名/值”对象（JavaScript对象）或数组。在迭代数组的情况下，回调函数每次传递一个数组索引和相应的数组值作为参数。
        // （该值也可以通过访问this关键字得到，但是JavaScript将始终将this值作为一个Object ，即使它是一个简单的字符串或数字值。）该方法返回其第一个参数，这是迭代的对象
        //.attr()获取匹配的元素集合中的第一个元素的属性的值  或 设置每一个匹配元素的一个或多个属性。
    }

    function onlordJudge(){
        var windowTopWebTop=$(document).scrollTop();
        var windowBottomWebTop=$(window).height();
        var targetTop=$(".GuessCell").last().offset().top-Math.floor($(".GuessCell").last().height()/2);
        return (targetTop<windowBottomWebTop+windowTopWebTop)?true:false;
    }

    $(window).scroll(function(){
        if(onlordJudge()){
            createYouLikeCell(data);
        }
    });
    createYouLikeCell(data);
}


